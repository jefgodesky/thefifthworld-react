!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=9)}([function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(3)),a=d(r(0)),s=d(r(1)),i=d(r(10)),u=d(r(11)),c=d(r(4)),o=d(r(12)),l=r(8),p=r(23),f=r(7);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t,r){var n=this;(0,i.default)(this,e),this.id=t.id,this.title=t.title,this.description=t.description,this.image=t.image,this.header="null"===t.header?null:t.header,this.slug=t.slug,this.path=t.path,this.parent=t.parent,this.type=t.type,this.file=t.file,this.permissions=t.permissions.toString(),this.owner=t.owner,this.claim=t.claim,this.depth=t.depth,this.lat=t.lat,this.lon=t.lon,this.likes=t.likes,this.changes=[],r.forEach(function(e){n.changes.unshift({id:e.id,timestamp:new Date(1e3*e.timestamp),msg:e.msg,content:JSON.parse(e.json),editor:{name:e.editorName?e.editorName:e.editorEmail?e.editorEmail:"Member #"+e.editorID,id:e.editorID}})})}return(0,u.default)(e,[{key:"checkPermissions",value:function(e,t){return(0,p.checkPermissions)(e,this,t)}},{key:"canRead",value:function(e){return(0,p.canRead)(e,this)}},{key:"canWrite",value:function(e){return(0,p.canWrite)(e,this)}},{key:"update",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n,s,i){var u,c,o,p,f,d,h,v,b,m,g,k,x,y,w,E,S,A,L,N,R,O=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:u=["title","description","image","header","slug","path","parent","permissions","owner","type"],c=["title","header","type"],o={},p=!0,f=!1,d=void 0,t.prev=6,h=u[Symbol.iterator]();case 8:if(p=(v=h.next()).done){t.next=23;break}if(b=v.value,!r.hasOwnProperty(b)||this[b]===r[b]){t.next=20;break}if("parent"!==b){t.next=19;break}return t.next=14,e.get(r.parent,i);case 14:m=t.sent,o.parent=m&&m.id?m.id:0,o.depth=m&&!isNaN(m.depth)?m.depth+1:this.depth,t.next=20;break;case 19:"path"===b?(g=r.path.split("/"),o.slug=g.length>0?g.pop():this.slug,o.path=r.path):"permissions"===b?o.permissions=r.permissions.toString():c.includes(b)&&""===r[b]?o[b]=null:o[b]=r[b];case 20:p=!0,t.next=8;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(6),f=!0,d=t.t0;case 29:t.prev=29,t.prev=30,!p&&h.return&&h.return();case 32:if(t.prev=32,!f){t.next=35;break}throw d;case 35:return t.finish(32);case 36:return t.finish(29);case 37:if(r.body&&(k=r.type?r.type:e.getType(r.body),x=e.getClaim(r.body),k&&this.type!==k&&(o.type=k),this.claim!==x&&(o.claim=x),(y=e.getLocation(r.body))&&(o.lat=y.lat,o.lon=y.lon)),w=o.path?o.path:this.path,E=o.type?o.type:this.type,S=o.title?o.title:this.title,!e.isReservedPath(w)){t.next=45;break}throw new Error(w+" is a reserved path.");case 45:if(!e.isReservedTemplate(E,S)){t.next=49;break}throw new Error("{{"+S+"}} is used internally. You cannot create a template with that name.");case 49:if(Object.keys(o).forEach(function(e){O[e]=o[e]}),A=[{name:"title",type:"string"},{name:"description",type:"string"},{name:"image",type:"string"},{name:"header",type:"string"},{name:"slug",type:"string"},{name:"path",type:"string"},{name:"parent",type:"number"},{name:"type",type:"string"},{name:"permissions",type:"number"},{name:"owner",type:"number"},{name:"claim",type:"number"},{name:"depth",type:"number"},{name:"lat",type:"number"},{name:"lon",type:"number"}],L=(0,l.updateVals)(A,o),t.prev=52,""===L){t.next=56;break}return t.next=56,i.run("UPDATE pages SET "+L+" WHERE id="+this.id+";");case 56:return N=Math.floor(Date.now()/1e3),t.next=59,i.run("INSERT INTO changes (page, editor, timestamp, msg, json) VALUES ("+this.id+", "+n.id+", "+N+", "+(0,l.SQLEscape)(s)+", "+(0,l.SQLEscape)(JSON.stringify(r))+");");case 59:if(R=t.sent,!r.body||"Name"!==this.type){t.next=65;break}return t.next=63,e.linkName(this.path,r.body,i);case 63:t.next=68;break;case 65:if("Name"===this.type){t.next=68;break}return t.next=68,e.unlinkName(this.path,i);case 68:this.changes.unshift({id:R.insertId,timestamp:N,msg:s,content:r,editor:{name:n.getName(),id:n.id}}),t.next=74;break;case 71:throw t.prev=71,t.t1=t.catch(52),t.t1;case 74:case"end":return t.stop()}},t,this,[[6,25,29,37],[30,,32,36],[52,71]])}));return function(e,r,n,a){return t.apply(this,arguments)}}()},{key:"getNames",value:function(){var t=(0,s.default)(a.default.mark(function t(r){var n,s,i,u,c,o,l,p,f;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.next=3,this.getChildren(r,"Name");case 3:s=t.sent,i=!0,u=!1,c=void 0,t.prev=7,o=s[Symbol.iterator]();case 9:if(i=(l=o.next()).done){t.next=18;break}return p=l.value,t.next=13,e.getName(p.path,r);case 13:f=t.sent,n.push(f);case 15:i=!0,t.next=9;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(7),u=!0,c=t.t0;case 24:t.prev=24,t.prev=25,!i&&o.return&&o.return();case 27:if(t.prev=27,!u){t.next=30;break}throw c;case 30:return t.finish(27);case 31:return t.finish(24);case 32:return t.abrupt("return",n);case 33:case"end":return t.stop()}},t,this,[[7,20,24,32],[25,,27,31]])}));return function(e){return t.apply(this,arguments)}}()},{key:"getNamesKnown",value:function(){var t=(0,s.default)(a.default.mark(function t(r){var n,s,i,u,c,o,p,f,d;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.next=3,r.run("SELECT name FROM names WHERE knower = "+(0,l.SQLEscape)(this.path)+";");case 3:s=t.sent,i=!0,u=!1,c=void 0,t.prev=7,o=s[Symbol.iterator]();case 9:if(i=(p=o.next()).done){t.next=18;break}return f=p.value,t.next=13,e.getName(f.name,r);case 13:d=t.sent,n.push(d);case 15:i=!0,t.next=9;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(7),u=!0,c=t.t0;case 24:t.prev=24,t.prev=25,!i&&o.return&&o.return();case 27:if(t.prev=27,!u){t.next=30;break}throw c;case 30:return t.finish(27);case 31:return t.finish(24);case 32:return t.abrupt("return",n);case 33:case"end":return t.stop()}},t,this,[[7,20,24,32],[25,,27,31]])}));return function(e){return t.apply(this,arguments)}}()},{key:"rollbackTo",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r,n){var s,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(s=this.changes.filter(function(e){return e.id===t})).length){e.next=5;break}return i="Rollback to change #"+t,e.next=5,this.update(s[0].content,r,i,n);case 5:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getContent",value:function(){return this.changes[0].content}},{key:"getLineage",value:function(){var t=(0,s.default)(a.default.mark(function t(r){var s,i;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.parent){t.next=4;break}return t.abrupt("return",[]);case 4:return t.next=6,e.get(this.parent,r);case 6:return s=t.sent,t.next=9,s.getLineage(r);case 9:return i=t.sent,t.abrupt("return",[s].concat((0,n.default)(i)));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getChildren",value:function(){var e=(0,s.default)(a.default.mark(function e(t){var r,n,s,i,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"alphabetical";return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r="SELECT p.title, p.path, f.thumbnail FROM pages p LEFT JOIN files f ON f.page = p.id WHERE p.parent="+this.id,n=u?" AND p.type='"+u+"'":"",s=c?" LIMIT "+c:"",i="",e.t0=o,e.next="oldest"===e.t0?7:"newest"===e.t0?9:11;break;case 7:return i=" ORDER BY p.id ASC",e.abrupt("break",13);case 9:return i=" ORDER BY p.id DESC",e.abrupt("break",13);case 11:return i=" ORDER BY p.title ASC",e.abrupt("break",13);case 13:return e.abrupt("return",t.run(""+r+n+i+s+";"));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"like",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.likes.indexOf(t)<0&&!isNaN(t))){e.next=9;break}return e.next=4,r.run("SELECT id FROM likes WHERE page = "+this.id+" AND member = "+t+";");case 4:if(0!==e.sent.length){e.next=9;break}return e.next=8,r.run("INSERT INTO likes (path, page, member) VALUES ("+(0,l.SQLEscape)(this.path)+", "+this.id+", "+t+");");case 8:this.likes.push(t);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"unlike",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(isNaN(t)){e.next=4;break}return e.next=3,r.run("DELETE FROM likes WHERE page = "+this.id+" AND member = "+t+";");case 3:this.likes=this.likes.filter(function(e){return e!==t});case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"isReservedPath",value:function(e){var t=!1,r=!0,n=!1,a=void 0;try{for(var s,i=[/^\/login(\/(.*))?$/g,/^\/login-route(\/(.*))?$/g,/^\/logout(\/(.*))?$/g,/^\/connect(\/(.*))?$/g,/^\/disconnect(\/(.*))?$/g,/^\/member(\/(.*))?$/g,/^\/welcome(\/(.*))?$/g,/^\/invite(\/(.*))?$/g,/^\/join(\/(.*))?$/g,/^\/forgot-passphrase(\/(.*))?$/g,/^\/dashboard(\/(.*))?$/g,/^\/new(\/(.*))?$/g,/^\/upload(\/(.*))?$/g,/^\/autocomplete(\/(.*))?$/g,/^\/like(\/(.*))?$/g,/^\/unlike(\/(.*))?$/g,/^\/explore(\/(.*))?$/g][Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var u=s.value;e.match(u)&&(t=!0)}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return t}},{key:"isReservedTemplate",value:function(e,t){return"Template"===e&&["Template","Children","Gallery","Artists","Art","Download"].indexOf(t)>-1}},{key:"getDescription",value:function(){var e=(0,s.default)(a.default.mark(function e(t){var r,n,s,i,u,c,l,p,f;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=150,e.next=3,(0,o.default)(t);case 3:if((n=e.sent)&&0!==n.length){e.next=8;break}return e.abrupt("return","Four hundred years from now, humanity thrives beyond civilization.");case 8:if(!(n.length<r)){e.next=12;break}return e.abrupt("return",n);case 12:if(s=n.match(/[^\.!\?]+[\.!\?]+/g),i=s[0],u=1,c=!1,i.length<r)for(;!c;)!(l=s.length>u?i.trim()+" "+s[u].trim():null)||l.length>r||u===s.length-1?c=!0:(i=l,u++);else{for(p=i.split(" "),i=p[0];!c;)!(f=p.length>u?i.trim()+" "+p[u].trim():null)||f.length>r-1||u===p.length-1?c=!0:(i=f,u++);i+="…"}return e.abrupt("return",i);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTags",value:function(e){var t=e.match(/\[\[(.+?)\]\]/gm);if(t){var r={};return t.map(function(e){return e.match(/\[\[(.+?):(.+?)\]\]/)}).filter(function(e){return null!==e}).forEach(function(e){var t=e[1],a=e[2],s=r[t];void 0===s?r[t]=a:"string"==typeof s?r[t]=[s,a]:Array.isArray(s)&&(r[t]=[].concat((0,n.default)(s),[a]))}),r}return!1}},{key:"getTag",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var n=new RegExp("\\[\\["+t+":(.+?)\\]\\]","g"),a=e.match(n);if(a&&a.length>0){if(r){var s=a.shift(),i=s.substr(2,s.length-4).split(":");return i[0]===t?i[1]:null}return a.map(function(e){return e.substr(2,e.length-4).split(":")}).filter(function(e){return e[0]===t}).map(function(e){return e[1]})}}}},{key:"getLocation",value:function(t){var r=e.getTag(t,"Location",!0);return!!r&&(2===(r=r.split(",")).length&&{lat:parseFloat(r[0].trim()),lon:parseFloat(r[1].trim())})}},{key:"getType",value:function(t){var r=e.getLocation(t),n=e.getTag(t,"Type",!0);return r?"Place":n||null}},{key:"getClaim",value:function(t){var r=e.getTag(t,"Owner",!0);return r=parseInt(r),isNaN(r)?null:r}},{key:"getPath",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n,s){var i,u;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(n,s);case 2:if(i=t.sent,!(u=r.slug?r.slug:r.title?(0,c.default)(r.title):null)){t.next=8;break}return t.abrupt("return",i&&i.path?i.path+"/"+u:"/"+u);case 8:return t.abrupt("return",!1);case 9:case"end":return t.stop()}},t,this)}));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"getParent",value:function(e){return(0,f.isPopulatedArray)(e.lineage)&&(0,f.isPopulatedArray)(e.lineage[0].changes)&&e.lineage[0].changes[0]&&e.lineage[0].changes[0].content?e.lineage[0].changes[0].content:void 0}},{key:"create",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n,s,i){var u,o,p,f,d,h,v,b,m,g,k,x,y,w,E,S;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=r.slug?r.slug:(0,c.default)(r.title),!r.parent){t.next=7;break}return t.next=4,e.get(r.parent,i);case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=null;case 8:if(o=t.t0,p=o?o.id:0,!r.path){t.next=14;break}t.t1=r.path,t.next=17;break;case 14:return t.next=16,e.getPath(r,o,i);case 16:t.t1=t.sent;case 17:if(f=t.t1,d=r.title?r.title:"",!r.description){t.next=23;break}t.t2=r.description,t.next=26;break;case 23:return t.next=25,e.getDescription(r.body);case 25:t.t2=t.sent;case 26:if(h=t.t2,v=r.image,b=r.header?r.header:null,m=r.body?e.getClaim(r.body):null,g=r.permissions?r.permissions:774,k=o?o.depth+1:0,x=r.type?r.type:e.getType(r.body),y=e.getLocation(r.body),!e.isReservedPath(f)){t.next=38;break}throw new Error(f+" is a reserved path.");case 38:if(!e.isReservedTemplate(x,d)){t.next=42;break}throw new Error("{{"+d+"}} is used internally. You cannot create a template with that name.");case 42:return t.prev=42,w=y?"INSERT INTO pages (slug, path, parent, type, title, description, image, header, permissions, owner, claim, depth, lat, lon) VALUES ("+(0,l.SQLEscape)(u)+", "+(0,l.SQLEscape)(f)+", "+p+", "+(0,l.SQLEscape)(x)+", "+(0,l.SQLEscape)(d)+", "+(0,l.SQLEscape)(h)+", "+(0,l.SQLEscape)(v)+", "+(0,l.SQLEscape)(b)+", "+g+", "+n.id+", "+m+", "+k+", "+y.lat+", "+y.lon+");":"INSERT INTO pages (slug, path, parent, type, title, description, image, header, permissions, owner, claim, depth) VALUES ("+(0,l.SQLEscape)(u)+", "+(0,l.SQLEscape)(f)+", "+p+", "+(0,l.SQLEscape)(x)+", "+(0,l.SQLEscape)(d)+", "+(0,l.SQLEscape)(h)+", "+(0,l.SQLEscape)(v)+", "+(0,l.SQLEscape)(b)+", "+g+", "+n.id+", "+m+", "+k+");",t.next=46,i.run(w);case 46:return E=t.sent,S=E.insertId,t.next=50,i.run("INSERT INTO changes (page, editor, timestamp, msg, json) VALUES ("+S+", "+n.id+", "+Math.floor(Date.now()/1e3)+", "+(0,l.SQLEscape)(s)+", "+(0,l.SQLEscape)(JSON.stringify(r))+");");case 50:if("Name"!==x){t.next=53;break}return t.next=53,e.linkName(f,r.body,i);case 53:return t.abrupt("return",e.get(S,i));case 56:throw t.prev=56,t.t3=t.catch(42),t.t3;case 59:case"end":return t.stop()}},t,this,[[42,56]])}));return function(e,r,n,a){return t.apply(this,arguments)}}()},{key:"get",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n){var s,i,u,c;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r||!r.constructor||"Page"!==r.constructor.name){t.next=4;break}return t.abrupt("return",r);case 4:if(!r){t.next=34;break}if("string"!=typeof r){t.next=11;break}return t.next=8,n.run("SELECT * FROM pages WHERE path='"+r+"';");case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,n.run("SELECT * FROM pages WHERE id="+r+";");case 13:t.t0=t.sent;case 14:if(1!==(s=t.t0).length){t.next=31;break}return t.next=18,n.run("SELECT c.id AS id, c.timestamp AS timestamp, c.msg AS msg, c.json AS json, m.name AS editorName, m.email AS editorEmail, m.id AS editorID FROM changes c, members m WHERE c.editor=m.id AND c.page="+s[0].id+" ORDER BY c.timestamp DESC;");case 18:return(i=t.sent).reverse(),t.next=22,n.run("SELECT * FROM files WHERE page="+s[0].id+" ORDER BY timestamp DESC;");case 22:return(u=t.sent)&&(s[0].file=u[0]),t.next=26,n.run("SELECT member FROM likes WHERE page="+s[0].id+";");case 26:return(c=t.sent)&&(s[0].likes=c.map(function(e){return e.member})),t.abrupt("return",new e(s[0],i));case 31:return t.abrupt("return",null);case 32:t.next=35;break;case 34:return t.abrupt("return",null);case 35:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"linkName",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n,s){var i,u,c,o,p,f,d;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=e.getTag(n,"Knower"),u=!0,c=!1,o=void 0,t.prev=4,p=i[Symbol.iterator]();case 6:if(u=(f=p.next()).done){t.next=17;break}return d=f.value,t.next=10,s.run("SELECT id FROM names WHERE name = "+(0,l.SQLEscape)(r)+" AND knower = "+(0,l.SQLEscape)(d)+";");case 10:if(0!==t.sent.length){t.next=14;break}return t.next=14,s.run("INSERT INTO names (name, knower) VALUES ("+(0,l.SQLEscape)(r)+", "+(0,l.SQLEscape)(d)+");");case 14:u=!0,t.next=6;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(4),c=!0,o=t.t0;case 23:t.prev=23,t.prev=24,!u&&p.return&&p.return();case 26:if(t.prev=26,!c){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(23);case 31:case"end":return t.stop()}},t,this,[[4,19,23,31],[24,,26,30]])}));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"unlinkName",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.run("DELETE FROM names WHERE name = "+(0,l.SQLEscape)(t)+";");case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getName",value:function(){var t=(0,s.default)(a.default.mark(function t(r,n){var s,i,u,c,o,l,p,f,d,h,v,b,m;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r||!r.constructor||"Page"!==r.constructor.name){t.next=4;break}t.t0=r,t.next=7;break;case 4:return t.next=6,e.get(r,n);case 6:t.t0=t.sent;case 7:if(!(s=t.t0)){t.next=47;break}return t.next=11,e.get(s.parent,n);case 11:i=t.sent,u=s.getContent(),c=u.body?u.body:null,o=c?e.getTag(c,"Knower"):[],l=[],p=!0,f=!1,d=void 0,t.prev=19,h=o[Symbol.iterator]();case 21:if(p=(v=h.next()).done){t.next=30;break}return b=v.value,t.next=25,e.get(b,n);case 25:(m=t.sent)&&l.push({name:m.title,path:b});case 27:p=!0,t.next=21;break;case 30:t.next=36;break;case 32:t.prev=32,t.t1=t.catch(19),f=!0,d=t.t1;case 36:t.prev=36,t.prev=37,!p&&h.return&&h.return();case 39:if(t.prev=39,!f){t.next=42;break}throw d;case 42:return t.finish(39);case 43:return t.finish(36);case 44:return t.abrupt("return",{name:s.title,path:s.path,body:c,known:{name:i.title,path:i.path},knowers:l});case 47:return t.abrupt("return",null);case 48:case"end":return t.stop()}},t,this,[[19,32,36,44],[37,,39,43]])}));return function(e,r){return t.apply(this,arguments)}}()},{key:"autocomplete",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r){var n,s;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l.SQLEscape)(t),s=n.substr(1,n.length-2),e.abrupt("return",r.run("SELECT * FROM pages WHERE title LIKE '%"+s+"%' LIMIT 5;"));case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getPaths",value:function(){var e=(0,s.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(function(e){return(0,l.SQLEscape)(e)}).join(", "),e.abrupt("return",r.run("SELECT title, path FROM pages WHERE title IN ("+n+") OR path IN ("+n+") ORDER BY depth, id;"));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}();t.default=h},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){var t="àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;",r=new RegExp(t.split("").join("|"),"g");return e?e.toLowerCase().replace(/\s+/g,"-").replace(r,function(e){return"aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------".charAt(t.indexOf(e))}).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""):""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),a=o(r(1)),s=o(r(13)),i=o(r(14)),u=o(r(15)),c=r(16);function o(e){return e&&e.__esModule?e:{default:e}}s.default.setOptions({sanitize:!0,sanitizer:function(e){var t="br aside pre code div ins del sup sub section aside nav blockquote cite dl dt dd ul ol li span strong em".split(" "),r=e.replace(/<\/?(.*?)>/g,"$1 ").split(" ");return r.length>0&&t.indexOf(r[0])>-1?e:""},smartLists:!0,smartypants:!0,xhtml:!0});var l,p=(l=(0,a.default)(n.default.mark(function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=45;break}if(t=(t=t.replace(/{{Template}}(.*?){{\/Template}}/g,"")).replace(/\[\[Type:(.*?)\]\]/g,""),!r){e.next=7;break}return e.next=6,(0,i.default)(t,r);case 6:t=e.sent;case 7:if(t=(0,s.default)(t.trim()),t=(0,c.escapeCodeBlockMarkdown)(t),t=(0,c.parseForm)(t),!r){e.next=14;break}return e.next=13,(0,c.listArtists)(t,r);case 13:t=e.sent;case 14:if(t=(0,c.doNotEmail)(t),t=(0,c.parseTags)(t),!r){e.next=41;break}return e.next=19,(0,c.parseDownload)(t,r);case 19:return t=e.sent,e.next=22,(0,c.parseArt)(t,r);case 22:return t=e.sent,e.next=25,(0,c.parseNovelListing)(t,r);case 25:return t=e.sent,e.next=28,(0,c.listChildren)(t,a,r,!0);case 28:return t=e.sent,e.next=31,(0,c.listChildren)(t,a,r);case 31:return t=e.sent,e.next=34,(0,c.listOtherNames)(t,a,r);case 34:return t=e.sent,e.next=37,(0,c.listNamesKnown)(t,a,r);case 37:return t=e.sent,e.next=40,(0,u.default)(t,r);case 40:t=e.sent;case 41:return t=(0,c.unwrapDivs)(t),e.abrupt("return",t);case 45:return e.abrupt("return",!1);case 46:case"end":return e.stop()}},e,void 0)})),function(e,t){return l.apply(this,arguments)});t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(18)("./production.json");t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestLocation=t.clone=t.getFileSizeStr=t.dedupe=t.formatDate=t.get=t.isPopulatedArray=t.checkExists=void 0;var n,a=r(3),s=(n=a)&&n.__esModule?n:{default:n};t.checkExists=function(e,t){for(t=t.split(".");e&&t.length;)e=e[t.shift()];return void 0!==e},t.isPopulatedArray=function(e){return Boolean(e&&Array.isArray(e)&&e.length>0)},t.get=function(e,t){for(t=t.split(".");e&&t.length;)e=e[t.shift()];return e},t.formatDate=function(e){var t=e.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],n=e.getFullYear(),a=e.getHours();return t+"&nbsp;"+r+"&nbsp;"+n+" "+(a>12?a-12:0===a?12:a)+":"+e.getMinutes().toString().padStart(2,"0")+"&nbsp;"+(a>=12?"PM":"AM")},t.dedupe=function(e){return[].concat((0,s.default)(new Set(e)))},t.getFileSizeStr=function(e){if(e<1e3)return e+" B";if(e<1e6){var t=e/1e3;return Math.round(10*t)/10+" kB"}if(e<1e9){var r=e/1e6;return Math.round(10*r)/10+" MB"}if(e){var n=e/1e9;return Math.round(10*n)/10+" GB"}return"0 B"},t.clone=function(e){var t=JSON.stringify(e);return JSON.parse(t)},t.requestLocation=function(e){return new Promise(function(t,r){navigator.geolocation.getCurrentPosition(t,r,e)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SQLEscape=t.generateInvitationCode=t.updateVals=void 0;var n=i(r(0)),a=i(r(1)),s=r(22);function i(e){return e&&e.__esModule?e:{default:e}}var u,c=function(e){return null===e|"null"===e?"NULL":(0,s.escape)(e)},o=(u=(0,a.default)(n.default.mark(function e(t){var r;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r="";case 1:if(""!==r){e.next=9;break}return r=Math.random().toString(36).replace("0.",""),e.next=5,t.run("SELECT id FROM invitations WHERE inviteCode='"+r+"';");case 5:e.sent.length>0&&(r=""),e.next=1;break;case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,void 0)})),function(e){return u.apply(this,arguments)});t.updateVals=function(e,t){var r=[],n=[],a={};return e.forEach(function(e){n.push(e.name),a[e.name]=e.type}),Object.keys(t).forEach(function(e){if(n.indexOf(e)>-1){var a=t[e];a=null===a||""===a?"NULL":c(a),r.push(e+"="+a)}}),r.join(", ")},t.generateInvitationCode=o,t.SQLEscape=c},function(e,t,r){"use strict";var n=c(r(0)),a=c(r(1)),s=c(r(2)),i=r(8),u=c(r(24));function c(e){return e&&e.__esModule?e:{default:e}}var o,l,p,f,d,h=(o=(0,a.default)(n.default.mark(function e(t,r){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.run("SELECT COUNT(id) AS count FROM "+t+" WHERE "+r+";");case 2:return a=e.sent,e.abrupt("return",a&&a[0]&&a[0].count<=0);case 4:case"end":return e.stop()}},e,void 0)})),function(e,t){return o.apply(this,arguments)}),v=(l=(0,a.default)(n.default.mark(function e(t,r){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("places","page="+t);case 2:if(!e.sent){e.next=7;break}return a=r.split(",").map(function(e){return e.trim()}),e.next=7,u.default.run("INSERT INTO places (page, location) VALUES ("+t+", ST_GeomFromText('POINT("+a.join(" ")+")', 4326));");case 7:case"end":return e.stop()}},e,void 0)})),function(e,t){return l.apply(this,arguments)}),b=(p=(0,a.default)(n.default.mark(function e(t,r,a){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("tags","page="+t+" AND tag="+(0,i.SQLEscape)(r)+" AND value="+(0,i.SQLEscape)(a));case 2:if(!e.sent){e.next=6;break}return e.next=6,u.default.run("INSERT INTO tags (page, tag, value) VALUES ("+t+", "+(0,i.SQLEscape)(r)+", "+(0,i.SQLEscape)(a)+");");case 6:case"end":return e.stop()}},e,void 0)})),function(e,t,r){return p.apply(this,arguments)}),m=(f=(0,a.default)(n.default.mark(function e(t){var r,a,i,u,c,o,l,p,f;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getContent(),a=s.default.getTags(r.body),i=!0,u=!1,c=void 0,e.prev=5,o=Object.keys(a)[Symbol.iterator]();case 7:if(i=(l=o.next()).done){e.next=19;break}p=l.value,f=a[p],e.t0=p,e.next="Location"===e.t0?13:"Type"===e.t0?14:15;break;case 13:return e.abrupt("return",v(t.id,f));case 14:return e.abrupt("break",16);case 15:return e.abrupt("return",b(t.id,p,f));case 16:i=!0,e.next=7;break;case 19:e.next=25;break;case 21:e.prev=21,e.t1=e.catch(5),u=!0,c=e.t1;case 25:e.prev=25,e.prev=26,!i&&o.return&&o.return();case 28:if(e.prev=28,!u){e.next=31;break}throw c;case 31:return e.finish(28);case 32:return e.finish(25);case 33:case"end":return e.stop()}},e,void 0,[[5,21,25,33],[26,,28,32]])})),function(e){return f.apply(this,arguments)});(d=(0,a.default)(n.default.mark(function e(){var t,r,a,i,c,o,l,p;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.run("SELECT id FROM pages;");case 2:t=e.sent,r=!0,a=!1,i=void 0,e.prev=6,c=t[Symbol.iterator]();case 8:if(r=(o=c.next()).done){e.next=17;break}return l=o.value,e.next=12,s.default.get(l.id,u.default);case 12:p=e.sent,m(p);case 14:r=!0,e.next=8;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),a=!0,i=e.t0;case 23:e.prev=23,e.prev=24,!r&&c.return&&c.return();case 26:if(e.prev=26,!a){e.next=29;break}throw i;case 29:return e.finish(26);case 30:return e.finish(23);case 31:case"end":return e.stop()}},e,void 0,[[6,19,23,31],[24,,26,30]])})),function(){return d.apply(this,arguments)})()},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(0)),a=i(r(1)),s=i(r(5));function i(e){return e&&e.__esModule?e:{default:e}}var u,c=function(e){var t=e.match(/\[\[(.*?)\]\]/g);return t&&t.forEach(function(t){var r=t.substr(2,t.length-4).trim(),n=r.split("|"),a=n.length>1?n[1]:r;e=e.replace(t,a)}),e},o=(u=(0,a.default)(n.default.mark(function e(t){var r;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)(t);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0="";case 5:return r=(r=e.t0).replace(/<[^>]*>?/gm,""),r=(r=(r=c(r)).replace(/{{(.*?)}}/g,"")).replace(/\s+/g," "),e.abrupt("return",r.trim());case 11:case"end":return e.stop()}},e,void 0)})),function(e){return u.apply(this,arguments)});t.default=o},function(e,t){e.exports=require("marked")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}var i,u,c=(i=(0,a.default)(n.default.mark(function e(t,r){var a,s,i,u,c,o,l,p;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],s=n.default.mark(function e(t){var s,i,u,c,o,l,p,f;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.replace(/\n/g,""),i=s.substr(2,s.length-4).replace(/\s(.*?)=["“”](.*?)["“”]/g,""),u=s.match(/\s(.*?)=["“”](.*?)["“”]/g),c={},u&&u.forEach(function(e){var t=e.trim().split("=");Array.isArray(t)&&t.length>0&&(c[t[0].trim()]=t[1].substr(1,t[1].length-2).trim())}),e.next=7,r.run("SELECT c.json AS json FROM changes c, pages p WHERE p.id=c.page AND p.type='Template' AND p.title='"+i+"' ORDER BY p.depth ASC, c.timestamp DESC;");case 7:(o=e.sent).length>0&&(l=JSON.parse(o[0].json).body.replace(/\[\[Type:(.*?)\]\]/g,"").trim(),(p=l.match(/{{Template}}(.+?){{\/Template}}/g))&&(f=p[0].substr(12,p[0].length-25),Object.keys(c).forEach(function(e){var t=new RegExp("{{{"+e+"}}}","g");f=f.replace(t,c[e])}),a.push({match:t,wikitext:f})));case 9:case"end":return e.stop()}},e,void 0)}),i=!0,u=!1,c=void 0,e.prev=5,o=t[Symbol.iterator]();case 7:if(i=(l=o.next()).done){e.next=13;break}return p=l.value,e.delegateYield(s(p),"t0",10);case 10:i=!0,e.next=7;break;case 13:e.next=19;break;case 15:e.prev=15,e.t1=e.catch(5),u=!0,c=e.t1;case 19:e.prev=19,e.prev=20,!i&&o.return&&o.return();case 22:if(e.prev=22,!u){e.next=25;break}throw c;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}},e,void 0,[[5,15,19,27],[20,,22,26]])})),function(e,t){return i.apply(this,arguments)}),o=(u=(0,a.default)(n.default.mark(function e(t,r){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.match(/{{((.*?)\n?)*?}}/g))){e.next=6;break}return e.next=4,c(a,r);case 4:(a=e.sent).forEach(function(e){t=t.replace(e.match,e.wikitext)});case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,void 0)})),function(e,t){return u.apply(this,arguments)});t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(0)),a=i(r(1)),s=i(r(2));function i(e){return e&&e.__esModule?e:{default:e}}var u,c,o=function(e){return e.map(function(e){var t=e.substr(2,e.length-4).trim().split("|").map(function(e){return e.trim()}),r="/"===t[0][0];return{orig:e,title:r?t[0].substr(t[0].indexOf(" ")+1):t[0],display:t.length>1?t[1]:t[0],usesPath:r}})},l=(u=(0,a.default)(n.default.mark(function e(t,r){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.getPaths(t.map(function(e){return e.title}),r);case 2:return e.sent.forEach(function(e){t.forEach(function(t){t.path||e.title.toLowerCase()!==t.title.toLowerCase()||(t.path=e.path),e.path===t.title&&(t.path=e.path)})}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,void 0)})),function(e,t){return u.apply(this,arguments)}),p=function(e){return e.map(function(e){return e.path?e:e.usesPath?Object.assign({},e,{path:"/new?path="+encodeURIComponent(e.title),isNew:!0}):Object.assign({},e,{path:"/new?title="+encodeURIComponent(e.title),isNew:!0})})},f=(c=(0,a.default)(n.default.mark(function e(t,r){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.match(/\[\[(.*?)\]\]/g))){e.next=8;break}return a=o(a),e.next=5,l(a,r);case 5:a=e.sent,(a=p(a)).forEach(function(e){var r=e.isNew?'<a href="'+e.path+'" class="new">'+e.display+"</a>":'<a href="'+e.path+'">'+e.display+"</a>";t=t.replace(e.orig,r)});case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}},e,void 0)})),function(e,t){return c.apply(this,arguments)});t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapDivs=t.parseNovelListing=t.parseForm=t.parseTags=t.parseArt=t.parseDownload=t.doNotEmail=t.listNamesKnown=t.listOtherNames=t.listArtists=t.listChildren=t.escapeCodeBlockMarkdown=void 0;var n=l(r(0)),a=l(r(1)),s=l(r(2)),i=r(17),u=r(7),c=l(r(4)),o=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}var p,f,d,h,v,b,m,g,k=(p=(0,a.default)(n.default.mark(function e(t,r,a,u){var c,o,l,p,f,d,h,v,b,m,g;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=[],!(o=t.match(r))){e.next=37;break}l=!0,p=!1,f=void 0,e.prev=6,d=o[Symbol.iterator]();case 8:if(l=(h=d.next()).done){e.next=23;break}if(v=h.value,!(b=(0,i.getProps)(v))[a]){e.next=20;break}return e.next=14,s.default.getPaths([b[a]],u);case 14:if(!(m=e.sent)){e.next=20;break}return e.next=18,s.default.get(m[0].path,u);case 18:g=e.sent,c.push({page:g,match:v,props:b});case 20:l=!0,e.next=8;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(6),p=!0,f=e.t0;case 29:e.prev=29,e.prev=30,!l&&d.return&&d.return();case 32:if(e.prev=32,!p){e.next=35;break}throw f;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return e.abrupt("return",c);case 38:case"end":return e.stop()}},e,void 0,[[6,25,29,37],[30,,32,36]])})),function(e,t,r,n){return p.apply(this,arguments)}),x=(f=(0,a.default)(n.default.mark(function e(t,r){var a,s,c,o,l,p,f,d,h,v,b,m;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t,/{{Download(}}|\s(.*?)}})/g,"file",r);case 2:for(a=e.sent,s=!0,c=!1,o=void 0,e.prev=6,l=a[Symbol.iterator]();!(s=(p=l.next()).done);s=!0)f=p.value,d=(0,u.getFileSizeStr)(f.page.file.size),h=(0,i.getURL)(f.page.file.name),v='<span class="label">'+f.page.file.name+"</span>",b='<span class="details">'+f.page.file.mime+"; "+d+"</span>",m='<a href="'+h+'" class="download">'+v+b+"</a>",t=t.replace(f.match,m);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),c=!0,o=e.t0;case 14:e.prev=14,e.prev=15,!s&&l.return&&l.return();case 17:if(e.prev=17,!c){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return e.abrupt("return",t);case 23:case"end":return e.stop()}},e,void 0,[[6,10,14,22],[15,,17,21]])})),function(e,t){return f.apply(this,arguments)}),y=(d=(0,a.default)(n.default.mark(function e(t,r){var a,s,u,c,o,l,p,f,d,h,v;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t,/{{Art(}}|\s(.*?)}})/g,"src",r);case 2:for(a=e.sent,s=!0,u=!1,c=void 0,e.prev=6,o=a[Symbol.iterator]();!(s=(l=o.next()).done);s=!0)p=l.value,f=p.props.caption?"<figcaption>"+p.props.caption+"</figcaption>":null,d=p.props.thumbnail&&p.page.file.thumbnail?'<img src="'+(0,i.getURL)(p.page.file.thumbnail)+'" alt="'+p.props.caption+'" />':'<img src="'+(0,i.getURL)(p.page.file.name)+'" alt="'+p.props.caption+'" />',h='<a href="'+p.page.path+'">'+d+"</a>",v=f?"<figure>"+h+f+"</figure>":"<figure>"+h+"</figure>",t=t.replace(p.match,v);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),u=!0,c=e.t0;case 14:e.prev=14,e.prev=15,!s&&o.return&&o.return();case 17:if(e.prev=17,!u){e.next=20;break}throw c;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return e.abrupt("return",t);case 23:case"end":return e.stop()}},e,void 0,[[6,10,14,22],[15,,17,21]])})),function(e,t){return d.apply(this,arguments)}),w=(h=(0,a.default)(n.default.mark(function e(t,r,a){var u,c,o,l,p,f,d,h,v,b,m,g,k,x,y,w,E,S,A,L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=L?/{{Gallery(.*?)}}/g:/{{Children(.*?)}}/g,!(c=t.match(u))){e.next=47;break}o=!0,l=!1,p=void 0,e.prev=6,f=c[Symbol.iterator]();case 8:if(o=(d=f.next()).done){e.next=33;break}return h=d.value,v=(0,i.getProps)(h),b=v.type?v.type:L?"Art":null,m=v.order?v.order:L?"newest":null,g=v.limit&&!isNaN(parseInt(v.limit))?parseInt(v.limit):null,v.of&&(r=v.of),e.next=17,s.default.get(r,a);case 17:if(!(k=e.sent)){e.next=24;break}return e.next=21,k.getChildren(a,b,g,m);case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=!1;case 25:x=e.t0,y="",x&&L?(w=x.filter(function(e){return e.path&&e.title&&e.thumbnail}).map(function(e){return'<li><a href="'+e.path+'"><img src="'+(0,i.getURL)(e.thumbnail)+'" alt="'+e.title+'" /></a>'}),y=w?'<ul class="gallery">\n'+w.join("\n")+"\n</ul>":""):x&&(E=x.map(function(e){return'<li><a href="'+e.path+'">'+e.title+"</a></li>"}),S=v.ordered?"ol":"ul",y=E?"<"+S+">\n"+E.join("\n")+"\n</"+S+">":""),A=t.match("<p>"+h+"</p>")?"<p>"+h+"</p>":h,t=t.replace(A,y);case 30:o=!0,e.next=8;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(6),l=!0,p=e.t1;case 39:e.prev=39,e.prev=40,!o&&f.return&&f.return();case 42:if(e.prev=42,!l){e.next=45;break}throw p;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.abrupt("return",t);case 48:case"end":return e.stop()}},e,void 0,[[6,35,39,47],[40,,42,46]])})),function(e,t,r){return h.apply(this,arguments)}),E=(v=(0,a.default)(n.default.mark(function e(t,r){var a,s,i;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.match(/{{Artists}}/g)){e.next=10;break}return e.next=4,r.run("SELECT title, path FROM pages WHERE type='Artist' ORDER BY title ASC;");case 4:return a=e.sent,s=a.map(function(e){return'<section class="artist"><h2><a href="'+e.path+'">'+e.title+'</a></h2>\n{{Gallery of="'+e.path+'" limit="4"}}\n</section>'}),e.next=8,w(s.join("\n"),"/art",r,!0);case 8:i=e.sent,t=t.replace(/{{Artists}}/gi,i);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e,void 0)})),function(e,t){return v.apply(this,arguments)}),S=(b=(0,a.default)(n.default.mark(function e(t,r,a){var i,u,c,l,p,f,d,h,v,b,m,g;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.get(r,a);case 2:if(!(i=e.sent)){e.next=54;break}return e.next=6,i.getNames(a);case 6:u=e.sent,c="",l=!0,p=!1,f=void 0,e.prev=11,d=u[Symbol.iterator]();case 13:if(l=(h=d.next()).done){e.next=40;break}v=h.value,b=v.knowers.map(function(e){return'<a href="'+e.path+'">'+e.name+"</a>"}),m="",e.t0=b.length,e.next=0===e.t0?20:1===e.t0?22:2===e.t0?24:26;break;case 20:return m=!1,e.abrupt("break",29);case 22:return m=b[0],e.abrupt("break",29);case 24:return m=b[0]+" and "+b[1],e.abrupt("break",29);case 26:return g=m.pop(),m=b.join(", ")+", and "+g,e.abrupt("break",29);case 29:return c+="<section>",c+="<h3>"+v.name+"</h3>",m&&(c+='<p class="known-to">Known to '+m+".</p>"),e.next=34,(0,o.default)(v.body,a);case 34:c+=e.sent,c+="</section>",t=t.replace(/{{OtherNames}}/gi,c);case 37:l=!0,e.next=13;break;case 40:e.next=46;break;case 42:e.prev=42,e.t1=e.catch(11),p=!0,f=e.t1;case 46:e.prev=46,e.prev=47,!l&&d.return&&d.return();case 49:if(e.prev=49,!p){e.next=52;break}throw f;case 52:return e.finish(49);case 53:return e.finish(46);case 54:return e.abrupt("return",t);case 55:case"end":return e.stop()}},e,void 0,[[11,42,46,54],[47,,49,53]])})),function(e,t,r){return b.apply(this,arguments)}),A=(m=(0,a.default)(n.default.mark(function e(t,r,a){var u,c,o,l,p,f,d,h,v,b,m,g,k,x,y,w,E,S;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(u=t.match(/{{NamesKnown(.*?)}}/g))){e.next=57;break}c=!0,o=!1,l=void 0,e.prev=5,p=u[Symbol.iterator]();case 7:if(c=(f=p.next()).done){e.next=43;break}return d=f.value,h=(0,i.getProps)(d),v=h.path?h.path:r,e.next=13,s.default.get(v,a);case 13:if(!(b=e.sent)){e.next=40;break}return e.next=17,b.getNamesKnown(a);case 17:for(m=e.sent,g="<table><thead><tr><th>Person or place</th><th>Known as</th></tr></thead><tbody>",k=!0,x=!1,y=void 0,e.prev=22,w=m[Symbol.iterator]();!(k=(E=w.next()).done);k=!0)S=E.value,g+='<tr><td><a href="'+S.known.path+'">'+S.known.name+'</a></td><td><a href="'+S.path+'">'+S.name+"</a></td></tr>";e.next=30;break;case 26:e.prev=26,e.t0=e.catch(22),x=!0,y=e.t0;case 30:e.prev=30,e.prev=31,!k&&w.return&&w.return();case 33:if(e.prev=33,!x){e.next=36;break}throw y;case 36:return e.finish(33);case 37:return e.finish(30);case 38:g+="</tbody></table>",t=t.replace(d,g);case 40:c=!0,e.next=7;break;case 43:e.next=49;break;case 45:e.prev=45,e.t1=e.catch(5),o=!0,l=e.t1;case 49:e.prev=49,e.prev=50,!c&&p.return&&p.return();case 52:if(e.prev=52,!o){e.next=55;break}throw l;case 55:return e.finish(52);case 56:return e.finish(49);case 57:return e.abrupt("return",t);case 58:case"end":return e.stop()}},e,void 0,[[5,45,49,57],[22,26,30,38],[31,,33,37],[50,,52,56]])})),function(e,t,r){return m.apply(this,arguments)}),L=(g=(0,a.default)(n.default.mark(function e(t,r){var a,s,c,o,l,p,f,d,h,v,b,m,g,k,x;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=t.match(/{{ListNovels(.*?)}}/g)||[])&&a.length>0)){e.next=7;break}return e.next=4,r.run("SELECT n.title, n.path, f.name AS src FROM pages n, pages c, files f WHERE n.type='Novel' AND c.type='Art' AND c.path=n.path+'/cover' AND c.parent=n.id AND f.page=c.id;");case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=null;case 8:if(s=e.t0,c="",!(0,u.isPopulatedArray)(s)){e.next=32;break}for(c='<ul class="novel-listing">\n',o=!0,l=!1,p=void 0,e.prev=15,f=s[Symbol.iterator]();!(o=(d=f.next()).done);o=!0)h=d.value,c+="  <li>\n",c+='    <a href="'+h.path+'">\n',c+='      <img src="'+(0,i.getURL)(h.src)+'" alt="'+h.title+'" />',c+="    </a>\n",c+="  </li>\n";e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),l=!0,p=e.t1;case 23:e.prev=23,e.prev=24,!o&&f.return&&f.return();case 26:if(e.prev=26,!l){e.next=29;break}throw p;case 29:return e.finish(26);case 30:return e.finish(23);case 31:c+="</ul>";case 32:for(v=!0,b=!1,m=void 0,e.prev=35,g=a[Symbol.iterator]();!(v=(k=g.next()).done);v=!0)x=k.value,t=t.replace(x,c);e.next=43;break;case 39:e.prev=39,e.t2=e.catch(35),b=!0,m=e.t2;case 43:e.prev=43,e.prev=44,!v&&g.return&&g.return();case 46:if(e.prev=46,!b){e.next=49;break}throw m;case 49:return e.finish(46);case 50:return e.finish(43);case 51:return e.abrupt("return",t);case 52:case"end":return e.stop()}},e,void 0,[[15,19,23,31],[24,,26,30],[35,39,43,51],[44,,46,50]])})),function(e,t){return g.apply(this,arguments)});t.escapeCodeBlockMarkdown=function(e){var t=e.match(/<pre>\s*<code>((.|\s)*?)<\/code>\s*<\/pre>/gm);if((0,u.isPopulatedArray)(t)){var r=!0,n=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value,o=c.match(/<pre>\s*<code>((.|\s)*?)<\/code>\s*<\/pre>/m);if(o&&o.length>1){for(var l=o[1].trim().replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&").replace(/“/gi,'"').replace(/”/gi,'"').replace(/‘/gi,"'").replace(/’/gi,"'"),p="",f=0;f<l.length;f++)10===l.charCodeAt(f)?p+="\n":l.charCodeAt(f)>31&&(p+="&#"+l.charCodeAt(f)+";");e=e.replace(c,"<pre><code>"+p+"</code></pre>")}}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}}return e},t.listChildren=w,t.listArtists=E,t.listOtherNames=S,t.listNamesKnown=A,t.doNotEmail=function(e){return e.replace(/<a href=\"mailto:(.*?)\">(.*?)<\/a>/g,"$2")},t.parseDownload=x,t.parseArt=y,t.parseTags=function(e){var t=!0,r=!1,n=void 0;try{for(var a,s=[/\[\[Type:(.*?)\]\]/g,/\[\[Location:(.*?)\]\]/g,/\[\[Owner:(.*?)\]\]/g,/\[\[Knower:(.*?)\]\]/g,/\[\[Author:(.*?)\]\]/g,/\[\[Artist:(.*?)\]\]/g,/\[\[Chapter:(.*?)\]\]/g][Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var i=a.value;e=e.replace(i,"").replace(/\ +/g," ").trim()}}catch(e){r=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw n}}return e},t.parseForm=function(e){var t=e.match(/{{Form((.|\n)*?)}}(.|\s)*?{{\/Form}}/gm)||[],r=!0,n=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var o=s.value,l=o.match(/{{Form((.|\n)*?)}}/m),p=l&&l[1]?(0,i.getProps)(l[1]):{},f=o.match(/{{Field((.|\s)*?)}}/gm)||[];f=f.map(function(e){return(0,i.getProps)(e)});var d='<form action="/save-form" method="post">\n';d+='  <input type="hidden" name="form" value="'+p.Name+'" />\n';var h=!0,v=!1,b=void 0;try{for(var m,g=f[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var k=m.value,x=(0,c.default)(p.Name+" "+k.Label),y=k.Type||"text";k.Note?(d+='  <label for="'+x+'">\n',d+="    "+k.Label+"\n",d+='    <p class="note">'+k.Note+"</p>\n",d+="  </label>\n"):d+='  <label for="'+x+'">'+k.Label+"</label>\n",d+="textarea"===y?'  <textarea name="'+(0,c.default)(k.Label)+'" id="'+x+'"></textarea>\n':'  <input type="'+y+'" name="'+(0,c.default)(k.Label)+'" id="'+x+'" />\n'}}catch(e){v=!0,b=e}finally{try{!h&&g.return&&g.return()}finally{if(v)throw b}}d+="  <button>"+(p.Button||"Send")+"</button>\n",d+="</form>",e=e.replace(o,d)}}catch(e){n=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw a}}return e},t.parseNovelListing=L,t.unwrapDivs=function(e){var t=e.match(/<p.*?>(.|\n)*?<\/p>/gm);if((0,u.isPopulatedArray)(t)){var r=!0,n=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value,o=c.match(/<p.*?>((.|\n)*?)<\/p>/m),l=(0,u.isPopulatedArray)(o)&&o.length>1?o[1]:null,p=l?l.match(/<div.*?>((.|\n)*?)<\/div>/gm):null;if((0,u.isPopulatedArray)(p)){var f=l,d=!0,h=!1,v=void 0;try{for(var b,m=p[Symbol.iterator]();!(d=(b=m.next()).done);d=!0){var g=b.value;f=f.replace(g,"")}}catch(e){h=!0,v=e}finally{try{!d&&m.return&&m.return()}finally{if(h)throw v}}""===f.trim()&&(e=e.replace(c,l))}}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}}return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProps=t.getURL=void 0;var n,a=r(6),s=(n=a)&&n.__esModule?n:{default:n};t.getURL=function(e){return"https://s3."+s.default.aws.region+".amazonaws.com/"+s.default.aws.bucket+"/"+e},t.getProps=function(e){var t=e.match(/\s(.*?)=(”|")(.*?)(”|")\/?/g),r={};if(t){var n=!0,a=!1,s=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var c=i.value.trim().split("=");if(Array.isArray(c)&&c.length>1){var o=c[0],l=c[1].substr(1,c[1].length-2);r[o]=l}}}catch(e){a=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}}return r}},function(e,t,r){var n={"./development.json":19,"./production.json":20,"./test.json":21};function a(e){var t=s(e);return r(t)}function s(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=s,e.exports=a,a.id=18},function(e){e.exports={domain:"localhost",root:"http://localhost:3000",port:3e3,secure:!1,sessionSecret:"BjGIiHZ8LfbxiPe3x2DrdsBB6U0Cahs7pEHsjHUk",db:{host:"127.0.0.1",user:"root",password:"password",database:"thefifthworld",insecureAuth:!0},mailgun:{key:"key-f1c8bcb853bb542fca3c4ad7f0cc0078",domain:"thefifthworld.com",from:"The Fifth World <web@thefifthworld.com>"},patreon:{id:"4ab64762928ae41fba507bafc6eca85e8b8d57adeda71f4e6eab37fe081be821",secret:"c82131846241bcf5f240f05ff3b36d7abdfa2f2db23f3483d4bc06f5fa1a293c",callback:"http://localhost:3000/login/patreon/callback"},discord:{id:"399316486042288128",secret:"EB7boHzi1Uz6oncg8JzVSbl3uYsGSsRa",callback:"http://localhost:3000/login/discord/callback",code:"KAMxHe2"},facebook:{id:"712669099096129",secret:"084ee46f569dc86368d3f84d35ea4c4a",callback:"http://localhost:3000/login/facebook/callback"},twitter:{key:"b5zv5BIpV6FJntB8ARm1M692l",secret:"Z3qk1RAZXEKno5WfKlM7Wj5AqYqQCYYxOJ3afu4TySpJ8Y0X6z",callback:"http://localhost:3000/login/twitter/callback"},google:{id:"348427910733-4luuh35baa1fchg19paqtuusamrilvsv.apps.googleusercontent.com",secret:"od55qhZbhLFBQ7BHzUy1KaUE",callback:"http://localhost:3000/login/google/callback"},aws:{key:"AKIAJCQQWAGICU6RSUTQ",secret:"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",bucket:"thefifthworld",region:"us-east-1"}}},function(e){e.exports={domain:"localhost",root:"https://thefifthworld.com",port:"80",secure:!1,sessionSecret:"BjGIiHZ8LfbxiPe3x2DrdsBB6U0Cahs7pEHsjHUk",db:{host:"127.0.0.1",user:"root",password:"password",database:"thefifthworld",insecureAuth:!0},mailgun:{key:"key-f1c8bcb853bb542fca3c4ad7f0cc0078",domain:"thefifthworld.com",from:"The Fifth World <web@thefifthworld.com>"},patreon:{id:"4ab64762928ae41fba507bafc6eca85e8b8d57adeda71f4e6eab37fe081be821",secret:"c82131846241bcf5f240f05ff3b36d7abdfa2f2db23f3483d4bc06f5fa1a293c",callback:"http://localhost:3000/login/patreon/callback"},discord:{id:"399316486042288128",secret:"EB7boHzi1Uz6oncg8JzVSbl3uYsGSsRa",callback:"http://localhost:3000/login/discord/callback",code:"KAMxHe2"},facebook:{id:"712669099096129",secret:"084ee46f569dc86368d3f84d35ea4c4a",callback:"http://localhost:3000/login/facebook/callback"},twitter:{key:"b5zv5BIpV6FJntB8ARm1M692l",secret:"Z3qk1RAZXEKno5WfKlM7Wj5AqYqQCYYxOJ3afu4TySpJ8Y0X6z",callback:"http://localhost:3000/login/twitter/callback"},google:{id:"348427910733-4luuh35baa1fchg19paqtuusamrilvsv.apps.googleusercontent.com",secret:"od55qhZbhLFBQ7BHzUy1KaUE",callback:"http://localhost:3000/login/google/callback"},aws:{key:"AKIAJCQQWAGICU6RSUTQ",secret:"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",bucket:"thefifthworld",region:"us-east-1"}}},function(e){e.exports={domain:"localhost",root:"http://localhost:3000",port:3e3,secure:!1,sessionSecret:"BjGIiHZ8LfbxiPe3x2DrdsBB6U0Cahs7pEHsjHUk",db:{host:"127.0.0.1",user:"root",password:"password",database:"thefifthworld_test",insecureAuth:!0},mailgun:{key:"key-f1c8bcb853bb542fca3c4ad7f0cc0078",domain:"thefifthworld.com",from:"The Fifth World <web@thefifthworld.com>"},patreon:{id:"4ab64762928ae41fba507bafc6eca85e8b8d57adeda71f4e6eab37fe081be821",secret:"c82131846241bcf5f240f05ff3b36d7abdfa2f2db23f3483d4bc06f5fa1a293c",callback:"http://localhost:3000/login/patreon/callback"},discord:{id:"399316486042288128",secret:"EB7boHzi1Uz6oncg8JzVSbl3uYsGSsRa",callback:"http://localhost:3000/login/discord/callback",code:"KAMxHe2"},facebook:{id:"712669099096129",secret:"084ee46f569dc86368d3f84d35ea4c4a",callback:"http://localhost:3000/login/facebook/callback"},twitter:{key:"b5zv5BIpV6FJntB8ARm1M692l",secret:"Z3qk1RAZXEKno5WfKlM7Wj5AqYqQCYYxOJ3afu4TySpJ8Y0X6z",callback:"http://localhost:3000/login/twitter/callback"},google:{id:"348427910733-4luuh35baa1fchg19paqtuusamrilvsv.apps.googleusercontent.com",secret:"od55qhZbhLFBQ7BHzUy1KaUE",callback:"http://localhost:3000/login/google/callback"},aws:{key:"AKIAJCQQWAGICU6RSUTQ",secret:"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",bucket:"thefifthworld-test",region:"us-east-2"}}},function(e,t){e.exports=require("sqlstring")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r){if(t&&t.permissions){var n="string"==typeof t.permissions?t.permissions:t.permissions.toString(),a=parseInt(n.charAt(0)),s=parseInt(n.charAt(1)),i=parseInt(n.charAt(2));return!(!e||!e.admin)||(!!(e&&e.id===t.owner&&a>=r)||(!!(e&&s>=r)||i>=r))}return!1};t.checkPermissions=n,t.canRead=function(e,t){return n(e,t,4)},t.canWrite=function(e,t){return!!e&&n(e,t,6)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(25)),a=s(r(6));function s(e){return e&&e.__esModule?e:{default:e}}var i=n.default.createPool(a.default.db);i.run=function(e){return new Promise(function(t,r){i.query(e,function(e,n,a){e?r(e):t(n,a)})})},t.default=i},function(e,t){e.exports=require("mysql")}]);